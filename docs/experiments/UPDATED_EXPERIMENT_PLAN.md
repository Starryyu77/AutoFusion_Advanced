# AutoFusion 完整实验计划 (更新版)

## 版本信息
- **Version**: 2.0
- **Date**: 2026-02-11
- **Status**: 待确认

---

## 实验总体架构

```
Phase 0: 基础设施验证 (已完成 ✅)
  ├─ 0.0: API 连接验证
  └─ 0.5: Mock vs Real API 对比

Phase 1: Prompt 策略对比 (待运行 ⏳)
  ├─ 目标: 确定最佳 Prompt 策略
  ├─ Generator: Real API (DeepSeek-V3)
  └─ 预算: ~3000元

Phase 2: Controller 算法对比 (已完成 ✅)
  ├─ 2.1: 算法对比 (Mock)
  │     └─ Evolution > PPO > GRPO > GDPO > Random
  │
  ├─ 2.5: 多数据集验证 (新增 ⭐)
  │     ├─ MMMU (综合学科)
  │     ├─ VSR (空间推理)
  │     ├─ MathVista (视觉数学)
  │     └─ AI2D (科学图表)
  │
  └─ 2.6: 评估器相关性验证 (新增 ⭐)
        └─ 1 Epoch vs 10 Epochs 相关性分析

Phase 3: 架构发现 (规划中 📋)
  ├─ 3.1: 最佳组合探索 (Evolution + Best Prompt)
  ├─ 3.2: 消融实验
  └─ 3.3: SOTA 刷榜 (MMMU Leaderboard)
```

---

## 新增 Phase 2.5: 多数据集验证

### 目标
验证融合层 (Fusion Layer) 在不同类型视觉-语言任务上的泛化能力。

### 数据集选择

| 数据集 | 类型 | 难度 | 验证能力 | 样本数 |
|--------|------|------|----------|--------|
| **MMMU** | 综合学科 | ⭐⭐⭐⭐⭐ | 通用知识融合 | ~11K |
| **VSR** | 空间推理 | ⭐⭐⭐ | 视觉关系理解 | ~10K |
| **MathVista** | 视觉数学 | ⭐⭐⭐⭐ | 视觉感知 + 推理 | ~6K |
| **AI2D** | 科学图表 | ⭐⭐⭐⭐ | 细粒度图文对齐 | ~4K |

### 实验设计

**控制变量**:
- Controller: Evolution (Phase 2.1 最优)
- Generator: CoT (基准)
- Seed: 42 (固定)
- Iterations: 50 (每个数据集)
- 评估器: Surgical Sandbox

**实验步骤**:
1. 用 Evolution 搜索 50 个架构
2. 在每个数据集上评估最佳架构
3. 分析跨数据集性能相关性
4. 识别"通用型"vs"专用型"架构

**预期产出**:
- 各数据集上的最佳架构
- 跨数据集性能热力图
- 融合层能力雷达图

**预算**:
- 搜索: 4 datasets × 50 iter = 200 次 API 调用
- 评估: 4 datasets × 10 architectures = 40 次完整评估
- **预估: ~500元**

---

## 新增 Phase 2.6: 评估器相关性验证

### 目标
验证 Surgical Sandbox (Quick Eval) 与 Full Training 的相关性，确保评估器可靠。

### 实验设计

**相关性验证 (Kendall's Tau)**:

| 架构 | 1 Epoch (Quick) | 10 Epochs (Full) | 相关性 |
|------|-----------------|------------------|--------|
| Arch 1 | Acc_1E | Acc_10E | τ1 |
| Arch 2 | Acc_1E | Acc_10E | τ2 |
| ... | ... | ... | ... |
| Arch 8 | Acc_1E | Acc_10E | τ8 |

**步骤**:
1. 选择 8 个代表性架构
   - 随机采样 4 个
   - Evolution 最佳 4 个
2. 每个架构跑两种配置:
   - Quick: 1 Epoch (~5 min)
   - Full: 10 Epochs (~30 min)
3. 计算 Kendall's Tau 相关系数
4. 验证 τ > 0.7 (强相关)

**预期产出**:
- 相关性散点图
- Kendall's Tau 统计值
- 评估器可靠性报告

**预算**:
- 8 architectures × 2 configs = 16 次训练
- **预估: ~50元** (GPU 时间)

---

## 更新后完整实验流程

### Phase 0: 基础设施 (已完成 ✅)
| 子阶段 | 目标 | 状态 | 成本 |
|--------|------|------|------|
| 0.0 | API 连接验证 | ✅ | ~20元 |
| 0.5 | Mock vs Real 对比 | ✅ | ~60元 |

### Phase 1: Prompt 策略对比 (⏳ 待运行)
| 子阶段 | 目标 | 配置 | 成本 |
|--------|------|------|------|
| 1.0 | CoT vs FewShot | 5策略×3seeds | ~3000元 |
| 1.1 | Critic vs Shape | 5策略×3seeds | 包含在1.0 |
| 1.2 | RolePlay | 5策略×3seeds | 包含在1.0 |

### Phase 2: 算法 + 验证 (✅ 部分完成)
| 子阶段 | 目标 | 配置 | 成本 |
|--------|------|------|------|
| 2.1 | Controller 对比 | 6算法×5seeds | 完成 ✅ |
| **2.5** | **多数据集验证** | 4数据集×50iter | **~500元** ⭐新增 |
| **2.6** | **评估器相关性** | 8架构×2配置 | **~50元** ⭐新增 |

### Phase 3: 架构发现 (📋 规划中)
| 子阶段 | 目标 | 配置 | 成本 |
|--------|------|------|------|
| 3.1 | 最佳组合探索 | Evolution+BestPrompt | ~3000元 |
| 3.2 | 消融实验 | 搜索空间/评估策略 | ~2000元 |
| 3.3 | SOTA 刷榜 | MMMU Leaderboard | ~2000元 |

---

## 预算汇总

| 阶段 | 描述 | 预算 (元) | 优先级 |
|------|------|-----------|--------|
| Phase 0 | 基础设施 | ~80 | 必需 ✅ |
| Phase 1 | Prompt 对比 | ~3000 | 高 |
| Phase 2.1 | 算法对比 | 完成 | - |
| **Phase 2.5** | **多数据集验证** | **~500** | **高** ⭐ |
| **Phase 2.6** | **评估器相关性** | **~50** | **高** ⭐ |
| Phase 3 | 架构发现 | ~7000 | 中 |
| **总计** | | **~10630** | |

---

## 风险评估

### HIGH Risk
- **数据集下载**: MMMU/VSR/MathVista/AI2D 需要下载和预处理
- **显存需求**: 多数据集评估需要更多 GPU 内存

### MEDIUM Risk
- **评估时间**: 4 个数据集完整评估时间较长
- **相关性不足**: 如果 1 Epoch vs 10 Epochs 相关性低 (τ<0.5)，需要调整评估器

### LOW Risk
- **成本超支**: 新增阶段成本可控 (~550元)
- **时间延迟**: 新增阶段预计 2-3 天完成

---

## 时间线

| 周次 | 任务 | 预计完成 |
|------|------|----------|
| Week 1 | Phase 2.6 评估器验证 | 2 天 |
| Week 1-2 | Phase 2.5 多数据集验证 | 3 天 |
| Week 2-3 | Phase 1 Prompt 对比 | 5 天 |
| Week 3-4 | Phase 3 架构发现 | 7 天 |
| Week 4-5 | 论文撰写 | 7 天 |

---

## 下一步行动

待确认后:
1. 下载 MMMU/VSR/MathVista/AI2D 数据集
2. 实现多数据集评估器 (MultiDatasetEvaluator)
3. 实现相关性分析脚本 (correlation_analysis.py)
4. 运行 Phase 2.6 (评估器验证)
5. 运行 Phase 2.5 (多数据集验证)

---

*Last Updated: 2026-02-11*
*Status: 待确认*
